<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MDMC.MD.interactions &mdash; MDMC 0.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=10f1778b"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            MDMC
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">2. Contributing to MDMC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/Argon-a-to-z.html">Argon A-to-Z</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/equilibrating-a-simulation.html">Equilibrating simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/running-a-refinement.html">Running a Refinement (in detail)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/understanding-units.html">Understanding scientific units in MDMC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/use-MDMC.html">How to use MDMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../how-to/installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/api/modules.html">MDMC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../explanation/explanation.html">Explanation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/overview.html">Developer Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MDMC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">MDMC.MD.interactions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for MDMC.MD.interactions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module in which all interactions between structural units are defined.</span>

<span class="sd"> ``Interaction`` is the abstract base class from which all interactions have to be derived..&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NoReturn</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">MethodType</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">MDMC.utilities.structures</span> <span class="kn">import</span> <span class="n">is_atom</span>
<span class="kn">from</span> <span class="nn">MDMC.MD.interaction_functions</span> <span class="kn">import</span> <span class="n">Coulomb</span>
<span class="kn">from</span> <span class="nn">MDMC.common</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">MDMC.common.decorators</span> <span class="kn">import</span> <span class="n">repr_decorator</span><span class="p">,</span> <span class="n">unit_decorator</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">MDMC.MD.parameters</span> <span class="kn">import</span> <span class="n">Parameters</span>
    <span class="kn">from</span> <span class="nn">MDMC.MD.interaction_functions</span> <span class="kn">import</span> <span class="n">InteractionFunction</span>
    <span class="kn">from</span> <span class="nn">MDMC.MD.simulation</span> <span class="kn">import</span> <span class="n">Universe</span>
    <span class="kn">from</span> <span class="nn">MDMC.MD.structures</span> <span class="kn">import</span> <span class="n">Atom</span>


<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="Interaction">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Interaction">[docs]</a>
<span class="nd">@repr_decorator</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Interaction</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for interactions, both bonded, non-bonded and constraints</span>

<span class="sd">    Each different type of interaction should have an ``Interaction`` object.</span>
<span class="sd">    This object contains a `list` of the ``Atom`` (or ```Atom`` pairs, triplets</span>
<span class="sd">    or quadruplets,  depending on the type of interaction) for which this</span>
<span class="sd">    ``Interaction`` applies. For example, an oxygen ``Coulombic`` interaction</span>
<span class="sd">    would contain a `list` of `tuple` where each `tuple` contains a different O</span>
<span class="sd">    ``Atom``, and a hydrogen-oxygen ``Bond`` interaction would contain a `list`</span>
<span class="sd">    of `tuple` where each `tuple` contains a different H and O pair.</span>
<span class="sd">    ``Interaction`` objects can be sliced to return a sublist of the `tuple`.</span>

<span class="sd">    When an ``Atom`` is passed to an ``Interaction``, the ``Interaction`` is</span>
<span class="sd">    also added to the ``Atom``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **settings</span>
<span class="sd">        ``function`` (`InteractionFunction`)</span>
<span class="sd">            A class of interaction function (e.g. ``HarmonicPotential``)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Arguments:</span>
<span class="sd">        atom_tuples - One or more tuples consisting of one or more Atom objects.</span>
<span class="sd">        Each tuple contains all of the atoms involved in a single interaction.</span>
<span class="sd">        For example:</span>

<span class="sd">        H1 = Atom(&#39;H&#39;)</span>
<span class="sd">        H2 = Atom(&#39;H&#39;)</span>
<span class="sd">        O = Atom(&#39;O&#39;)</span>

<span class="sd">        For non-bonded interactions both of the following are equivalent</span>
<span class="sd">        (applying a Dispersion interaction to both H atoms):</span>

<span class="sd">        H_dispersive = Dispersion((H1, ), (H2, ))</span>
<span class="sd">        H_dispersive = Dispersion(H1, H2)</span>

<span class="sd">        For bonded interactions both of the following are equivalent:</span>

<span class="sd">        HO_bond = Bond((H1, O))</span>
<span class="sd">        HO_bond = Bond(H1, O)</span>

<span class="sd">        However when multiple bonds are initialized within a single Bond object</span>
<span class="sd">        (e.g. creating a Bond between each H and O for a single water molecule),</span>
<span class="sd">        tuples must be used to separate the bonds:</span>

<span class="sd">        HO_bond = Bond((H1, O), (H2,O))</span>

<span class="sd">        whereas the following is not valid:</span>

<span class="sd">        HO_bond = Bond(H1, O, H2, O)</span>
<span class="sd">        TypeError: object of type &#39;Atom&#39; has no len()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interactions cannot be copied</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Interactions cannot be deepcopied&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interactions cannot be copied</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Interactions cannot be copied&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;Atom&#39;</span><span class="p">,</span> <span class="s1">&#39;list[Atom]&#39;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the atoms on which the ``Interaction`` is applied</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Parameters&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the ``Parameter`` objects belonging to the ``InteractionFunction``</span>
<span class="sd">        belonging to the ``Interaction``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Parameters</span>
<span class="sd">            A ``Parameters`` object containing each ``Parameter``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">parameters</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;InteractionFunction&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the ``InteractionFunction`` of the ``Interaction``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        InteractionFunction</span>
<span class="sd">            The interaction function of the ``Interaction``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_function</span>

    <span class="nd">@function</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;InteractionFunction&#39;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of the ``InteractionFunction`` belonging to the</span>
<span class="sd">        ``Interaction``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The name of the ``InteractionFunction``, or `None` if no</span>
<span class="sd">            ``InteractionFunction`` has been set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">name</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Universe&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the ``Universe`` to which the ``Interaction`` belongs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Universe</span>
<span class="sd">            The ``Universe`` to which the ``Interaction`` belongs or `None`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="Interaction.element_list">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Interaction.element_list">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">element_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a `list` of the elements for which the ``Interaction`` applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The elements for which the ``Interaction`` applies</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="Interaction.sorted_element_list">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Interaction.sorted_element_list">[docs]</a>
    <span class="k">def</span> <span class="nf">sorted_element_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort the list of elements for which the ``Interaction`` applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The elements for which the ``Interaction`` applies, sorted</span>
<span class="sd">            alphabetically</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_list</span><span class="p">())</span></div>


<div class="viewcode-block" id="Interaction.element_tuple">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Interaction.element_tuple">[docs]</a>
    <span class="k">def</span> <span class="nf">element_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A `tuple` of elements for which the ``Interaction`` applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            The elements for which the ``Interaction`` applies</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element_list</span><span class="p">())</span></div>


    <span class="k">def</span> <span class="nf">_add_interaction_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">:</span> <span class="s1">&#39;list[Atom]&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the ``Interaction`` to atoms for which the ``Interaction`` has been</span>
<span class="sd">        applied</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atoms : list</span>
<span class="sd">            ``Atom`` objects which have been added to the ``Interaction``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_interaction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="NonBondedInteraction">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.NonBondedInteraction">[docs]</a>
<span class="nd">@repr_decorator</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;atom_types&#39;</span><span class="p">,</span> <span class="s1">&#39;cutoff&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NonBondedInteraction</span><span class="p">(</span><span class="n">Interaction</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for non-bonded interactions</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    universe : Universe</span>
<span class="sd">        The ``Universe`` in which the ``NonBondedInteraction`` exists</span>
<span class="sd">    *atom_types</span>
<span class="sd">        `int` for each ``atom_type`` for which the ``NonBondedInteraction``</span>
<span class="sd">        applies</span>
<span class="sd">    **settings</span>
<span class="sd">        ``cutoff`` (`float`)</span>
<span class="sd">            The distance in ``Ang`` at which the interaction potential is</span>
<span class="sd">            truncated</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_types</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">universe</span> <span class="o">=</span> <span class="n">universe</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">add_nonbonded_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cutoff&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> created: {function:</span><span class="si">%s</span><span class="s1">, atom_types:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Simplified version of immutable hash which Python3 produces</span>
        <span class="c1"># (marginally less efficient but shouldn&#39;t matter)</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The ``type``, ``atom_types`` and ``cutoff`` of the</span>
<span class="sd">            ``NonBondedInteraction``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> interaction  atom_types: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="si">}</span><span class="s1">  &#39;</span>
                <span class="sa">f</span><span class="s1">&#39; cutoff: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">atom_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;list[int]&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the atom types for which the ``NonBondedInteraction`` applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of `int` for the ``atom_types``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Universe&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the ``Universe`` to which the ``NonBondedInteraction``</span>
<span class="sd">        belongs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Universe</span>
<span class="sd">            The ``Universe`` to which the ``NonBondedInteraction`` belongs or</span>
<span class="sd">            `None`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_universe</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_universe</span>

    <span class="nd">@universe</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;Universe&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_universe</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_universe</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the distance in ``Ang`` at which the interaction potential is</span>
<span class="sd">        truncated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The distance in ``Ang`` of the ``cutoff``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cutoff</span>

    <span class="nd">@cutoff</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@unit_decorator</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">units</span><span class="o">.</span><span class="n">LENGTH</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cutoff</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="NonBondedInteraction.is_equivalent">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.NonBondedInteraction.is_equivalent">[docs]</a>
    <span class="k">def</span> <span class="nf">is_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for equivalence between two ``NonBondedInteraction``s, specifically</span>
<span class="sd">        if they apply to the same ``atom_types``, have the same ``cuttoff`` and</span>
<span class="sd">        the same ``function`` describing the interaction.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : NonBondedInteraction</span>
<span class="sd">            The object to compare against.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="ow">and</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
                     <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">atom_types</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">id</span><span class="p">))</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">cutoff</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">function</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Dispersion">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Dispersion">[docs]</a>
<span class="k">class</span> <span class="nc">Dispersion</span><span class="p">(</span><span class="n">NonBondedInteraction</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A non-bonded dispersive interaction - either LJ or Buckingham</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    universe : Universe</span>
<span class="sd">        The ``Universe`` in which the ``NonBondedInteraction`` exists</span>
<span class="sd">    *atom_types</span>
<span class="sd">        `int` for each atom type for which the ``NonBondedInteraction`` applies</span>
<span class="sd">    **settings</span>
<span class="sd">        ``cutoff`` (`float`)</span>
<span class="sd">            The distance in ``Ang`` at which the interaction potential is</span>
<span class="sd">            truncated</span>
<span class="sd">        ``vdw_tail_correction`` (`bool`)</span>
<span class="sd">            Specifies if the tail correction to the energy and pressure should</span>
<span class="sd">            be applied. This only affects the simulation dynamics if the</span>
<span class="sd">            simulation is being performed with constant pressure.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        ``atom_types`` must be iterable</span>
<span class="sd">    ValueError</span>
<span class="sd">        ``Dispersion`` should only be specified as existing between pairs of</span>
<span class="sd">        ``atom_types``</span>
<span class="sd">    TypeError</span>
<span class="sd">        Each ``atom_type`` must be `int`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Python3 requires subclasses that overwrite __eq__ to explicity inherit</span>
    <span class="c1"># __hash__</span>
    <span class="fm">__hash__</span> <span class="o">=</span> <span class="n">NonBondedInteraction</span><span class="o">.</span><span class="fm">__hash__</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">:</span> <span class="s1">&#39;Universe&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_types</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>

        <span class="c1"># Ignore pylint warning for inner function docstring</span>
        <span class="c1"># pylint: disable=missing-docstring</span>
        <span class="k">def</span> <span class="nf">validate_atom_type_pair</span><span class="p">(</span><span class="n">atom_type_pair</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">atom_type_pair</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">atom_type_pair</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Atom types must be an iterable&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom_type_pair</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Dispersion interactions should only be&#39;</span>
                                 <span class="s1">&#39; specified as existing between pairs of&#39;</span>
                                 <span class="s1">&#39; atom types&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">atom_type</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="k">for</span> <span class="n">atom_type</span>
                       <span class="ow">in</span> <span class="n">atom_type_pair</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Each atom type must be int&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">atom_type_pair</span>

        <span class="c1"># Remove duplicates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atom_types</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">({</span><span class="n">validate_atom_type_pair</span><span class="p">(</span><span class="n">atp</span><span class="p">)</span> <span class="k">for</span> <span class="n">atp</span>
                                  <span class="ow">in</span> <span class="n">atom_types</span><span class="p">})</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">universe</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="c1"># Add interactions to all atoms</span>
        <span class="k">for</span> <span class="n">atom_type_pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="n">atom_type_pair</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                    <span class="n">atom</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vdw_tail_correction</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vdw_tail_correction&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">atom_types</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
                                                                  <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atom_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_atom_types</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;list[tuple[list[Atom]]]&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the atoms on which the ``Dispersion`` is applied</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A `list` of two `tuple`, where each `tuple` contains a `list` of</span>
<span class="sd">            `Atom`. Every ``Atom`` in the first `tuple` has a dispersion</span>
<span class="sd">            interaction with every ``Atom`` in the second `tuple` (excluding</span>
<span class="sd">            self interactions). This is the complete list of possible dispersion</span>
<span class="sd">            interactions, i.e. it is only exactly correct if no cutoff has been</span>
<span class="sd">            specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">atom_types</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">tpl</span><span class="p">)</span> <span class="k">for</span> <span class="n">tpl</span>
                <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">]</span>

<div class="viewcode-block" id="Dispersion.element_list">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Dispersion.element_list">[docs]</a>
    <span class="k">def</span> <span class="nf">element_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of the elements for which the ``Interaction`` applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The elements for which the ``Interaction`` applies</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Each value in universe.atom_types dictionary contain list of atoms</span>
        <span class="c1"># with same elements, so use index 0</span>
        <span class="c1"># This is determined for all atom types in Dispersion interaction</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">atom_types</span><span class="p">[</span><span class="n">atom_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span>
                <span class="k">for</span> <span class="n">tpl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span>
                <span class="k">for</span> <span class="n">atom_type</span> <span class="ow">in</span> <span class="n">tpl</span><span class="p">]</span></div>


<div class="viewcode-block" id="Dispersion.is_equivalent">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Dispersion.is_equivalent">[docs]</a>
    <span class="k">def</span> <span class="nf">is_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for equivalence between two ``Dispersion``s, specifically</span>
<span class="sd">        if they apply to the same ``atom_types``, have the same ``cuttoff``,</span>
<span class="sd">        the same ``function`` describing the interaction and</span>
<span class="sd">        ``vdw_tail_correction`` setting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : Dispersion</span>
<span class="sd">            The object to compare against.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vdw_tail_correction</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">vdw_tail_correction</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Coulombic">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Coulombic">[docs]</a>
<span class="k">class</span> <span class="nc">Coulombic</span><span class="p">(</span><span class="n">NonBondedInteraction</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A non-bonded coulombic interaction - either normal or modified Coulomb</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    universe : Universe, optional</span>
<span class="sd">        The ``Universe`` in which the ``Coulombic`` exists. Default is `None`.</span>
<span class="sd">        Must be passed as a parameter if ``atom_types`` if passed.</span>
<span class="sd">    **settings</span>
<span class="sd">        ``charge`` (`float`)</span>
<span class="sd">            The charge parameter of the ``Coulombic`` interaction, in units of</span>
<span class="sd">            ``e``. If this argument is passed, the ``interaction_function`` of</span>
<span class="sd">            this ``Coulombic`` is set to ``Coulomb`` with this `float` as its</span>
<span class="sd">            ``Parameter``. Passing ``charge`` will overwrite any other</span>
<span class="sd">            ``interaction_functions`` that are set, i.e. it makes ``function``</span>
<span class="sd">            parameter redundant</span>
<span class="sd">        ``atoms`` (`list`)</span>
<span class="sd">            ``Atom`` objects to which the ``Coulombic`` applies. If specifying</span>
<span class="sd">            the ``atoms``, ``universe`` does not need to be passed as a</span>
<span class="sd">            parameter.</span>



<span class="sd">        atom_types : list of int</span>
<span class="sd">            int for each atom_type for which the NonBondedInteraction applies.</span>
<span class="sd">            If specifying the atom_types, the universe must be passed as a</span>
<span class="sd">            parameter and the atoms for which the atom_types are specified must</span>
<span class="sd">            exist in Universe. See the example above in the &#39;charge&#39; section.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If one or more atom_types are passed but no universe is passed</span>
<span class="sd">    TypeError</span>
<span class="sd">        If neither atom_types or atoms have been passed</span>
<span class="sd">    TypeError</span>
<span class="sd">        If both atom_types and atoms have been passed</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Upon initializing an ``Atom`` object and adding it to a ``Universe``:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        O = Atom(&#39;O&#39;, atom_type=1)</span>
<span class="sd">        universe = Universe(10.0)</span>
<span class="sd">        universe.add_structure(&#39;O&#39;)</span>

<span class="sd">    The following initializations of Coulombic are equivalent:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        O_coulombic = Coulombic(universe, atom_types=[O.atom_type],</span>
<span class="sd">                                charge=-0.84)</span>
<span class="sd">        O_coulombic = Coulombic(universe, atom_types=[O.atom_type],</span>
<span class="sd">                                function=Coulomb(-0.84))</span>

<span class="sd">    If ``atoms`` is passed then a ``Universe`` does not need to be passed:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        O_coulombic = Coulombic(atoms=[O], charge=-0.84)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Python3 requires subclasses thay overwrite __eq__ to explicity inherit</span>
    <span class="c1"># __hash__</span>
    <span class="fm">__hash__</span> <span class="o">=</span> <span class="n">NonBondedInteraction</span><span class="o">.</span><span class="fm">__hash__</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">:</span> <span class="s1">&#39;Universe&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># pylint: disable=not-callable</span>
        <span class="c1"># as it raises a false positive on self.add_atoms</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">atom_types</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;atom_types&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;atoms&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Cannot pass both atoms and atom_types &#39;</span>
                                <span class="s1">&#39;as parameters.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">atom_types</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)):</span>
                <span class="c1"># Account for init argument atom_types=atom_type</span>
                <span class="c1"># rather than atom_types=[atom_type]</span>
                <span class="n">atom_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom_types</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">universe</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Coulombic requires a universe when &#39;</span>
                                <span class="s1">&#39;atom_types are passed&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_atom_types</span> <span class="o">=</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">_add_atom_types</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atom_types</span> <span class="o">=</span> <span class="n">atom_types</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span> <span class="k">for</span> <span class="n">atom_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span>
                           <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">universe</span><span class="o">.</span><span class="n">atom_types</span><span class="p">[</span><span class="n">atom_type</span><span class="p">]]</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">universe</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>
            <span class="c1"># Add interaction to atoms</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="n">atom</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_atoms</span> <span class="o">=</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">_add_atoms</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;atoms&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Coulombic takes either atom_types or atoms &#39;</span>
                                <span class="s1">&#39;as parameters&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
            <span class="c1"># Account for init argument atoms=atom rather than atoms=[atom]</span>
            <span class="k">if</span> <span class="n">is_atom</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
                <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">atoms</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atom_types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_atoms</span><span class="p">(</span><span class="o">*</span><span class="n">atoms</span><span class="p">)</span>

            <span class="c1"># Assumes all atoms are in the same universe (or None)</span>
            <span class="n">universe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">universe</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">universe</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>

        <span class="n">charge</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">charge</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Initializes a Coulomb interaction function with charge and units</span>
            <span class="c1"># and assigns it to self.function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">Coulomb</span><span class="p">(</span><span class="n">charge</span><span class="p">)</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Coulombic interaction for the Atom object&#39;</span>
                           <span class="s1">&#39;initialized with the Coulomb interaction function.&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of interactions of this type that have been set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            The `tuple` of atoms at the specified index in ``atoms``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="ow">and</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
                     <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">atom_types</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">id</span><span class="p">))</span>
                <span class="ow">and</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">id</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;list[Atom]&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the atoms on which the ``Coulombic`` interaction is applied</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A `list` of ``Atom`` on which the ``Coulombic`` is applied</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atom_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the atom types for which the ``Coulombic`` applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            All atom types to which the ``Coulombic`` applies. If the</span>
<span class="sd">            interaction was initialized with ``atoms``, all ``atom_types``</span>
<span class="sd">            of the ``atoms`` to which the ``Coulombic`` was applied are</span>
<span class="sd">            returned; HOWEVER THE COULOMBIC INTERACTION IS NOT APPLIED TO ALL</span>
<span class="sd">            ATOMS OF THESE ``atom_types``, ONLY THE ATOMS IN ``self.atoms``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atom_types</span>

<div class="viewcode-block" id="Coulombic.element_list">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Coulombic.element_list">[docs]</a>
    <span class="k">def</span> <span class="nf">element_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of the elements for which the ``Coulombic`` interaction applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The elements for which the ``Coulombic`` interaction applies</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span><span class="p">]</span>
                        <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="o">.</span><span class="n">atom_types</span><span class="p">[</span><span class="n">atom_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span>
                           <span class="n">atom_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">]))</span></div>
</div>



<div class="viewcode-block" id="BondedInteraction">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.BondedInteraction">[docs]</a>
<span class="nd">@repr_decorator</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;n_atoms&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BondedInteraction</span><span class="p">(</span><span class="n">Interaction</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for bonded interactions</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_tuples : list</span>
<span class="sd">        A `list` of `tuple`. Each `tuple` contains ``Atom`` objects which are</span>
<span class="sd">        bonded together. For three or more ``Atom`` objects, the order of</span>
<span class="sd">        the ``Atom`` objects within each `tuple` is important.</span>
<span class="sd">    **settings</span>
<span class="sd">        ``n_atoms`` (`int`)</span>
<span class="sd">            The number of atoms to which this ``BondedInteraction`` applies, for</span>
<span class="sd">            example 2 for a ``Bond``.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    For a single bonded interactions which applies to ``H1``, ``O1``, and</span>
<span class="sd">    ``H2``:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        BondedInteraction(H1, O1, H2)</span>

<span class="sd">    For two bonded interactions of the same ``BondedInteraction`` type, one</span>
<span class="sd">    applied to ``H1``, ``O1`` and ``H2`` ``Atom`` objects, and the other applied</span>
<span class="sd">    to ``H3``, ``O2`` and ``H4`` ``Atom`` objects:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        BondedInteraction((H1, O1, H2), (H3, O2, H4))</span>

<span class="sd">    Whereas the above examples are both specifying a H-O-H ordered</span>
<span class="sd">    ``BondedInteraction``, the following specifies a H-H-O</span>
<span class="sd">    ``BondedInteraction``:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        BondAngle(H1, H2, O)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_tuples</span><span class="p">:</span> <span class="s1">&#39;list[tuple]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">atom_tuples</span> <span class="ow">and</span> <span class="n">is_atom</span><span class="p">(</span><span class="n">atom_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">atom_tuples</span> <span class="o">=</span> <span class="p">(</span><span class="n">atom_tuples</span><span class="p">,</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">):</span>
            <span class="c1"># This ensures that BondedInteractions can also be __init__ with 0</span>
            <span class="c1"># atoms</span>
            <span class="k">for</span> <span class="n">tpl</span> <span class="ow">in</span> <span class="n">atom_tuples</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_atoms</span><span class="p">(</span><span class="n">tpl</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">atom_tuples</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">settings</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> created: {function:</span><span class="si">%s</span><span class="s1">, atom IDs:</span><span class="si">%s</span><span class="s1">}&#39;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">,</span>
                    <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="n">tpl</span><span class="p">))</span> <span class="k">for</span> <span class="n">tpl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of interactions of this type that have been set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple</span>
<span class="sd">            The `tuple` of ``Atom`` at the specified index.  For a single index</span>
<span class="sd">            (as opposed to a slice) this is a group of atoms which are bonded</span>
<span class="sd">            together.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The type, and number of atoms of the ``BondedInteraction``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> interaction applied to </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span><span class="si">}</span><span class="s1"> atom tuples&#39;</span>

<div class="viewcode-block" id="BondedInteraction.is_equivalent">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.BondedInteraction.is_equivalent">[docs]</a>
    <span class="k">def</span> <span class="nf">is_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for equivalence between two ``BondedInteraction``s, specifically</span>
<span class="sd">        if they apply to the same ``atom_types`` and the same ``function``</span>
<span class="sd">        describing the interaction.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : BondedInteraction</span>
<span class="sd">            The object to compare against.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">atom_types</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">function</span><span class="p">))</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;list[tuple[Atom]]&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get or set the atoms on which the ``Coulombic`` interaction is applied</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A `list` of `tuple` containing one or more ``Atom``. Each `tuple`</span>
<span class="sd">            contains all of the atoms involved in one example of the</span>
<span class="sd">            interaction. For example a ``BondAngle`` interaction each `tuple`</span>
<span class="sd">            would contain 3 or 4 atoms.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If a `list` of `tuple` is not set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span>

    <span class="nd">@atoms</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atom_tuples</span><span class="p">:</span> <span class="s1">&#39;list[tuple[Atom]]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># Check for duplicate tuples in list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_duplicates</span><span class="p">(</span><span class="n">atom_tuples</span><span class="p">)</span>
        <span class="c1"># Check for duplicate atoms in each tuple</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tpl</span> <span class="ow">in</span> <span class="n">atom_tuples</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_duplicates</span><span class="p">(</span><span class="n">tpl</span><span class="p">)</span>
        <span class="c1"># try/except accounts for single atom passed rather than (atom,) tuple</span>
        <span class="c1"># e.g. if atom_tuples = [atom] instead of atom_tuples = [(atom,)]</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom_tuples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">is_atom</span><span class="p">(</span><span class="n">atom_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">atom_tuples</span> <span class="o">=</span> <span class="p">[(</span><span class="n">atom_tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">],)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">&#39;atom_tuples must be [(atom, ...), ...]&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>

        <span class="c1"># Only assign interaction to atoms after these validation steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tpl</span> <span class="ow">in</span> <span class="n">atom_tuples</span><span class="p">:</span>
            <span class="c1"># Each tuple is appended individually so that it can be easily added</span>
            <span class="c1"># to ._bonded_interaction_pairs for every atom in the tuple</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tpl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_interaction_atoms</span><span class="p">(</span><span class="n">tpl</span><span class="p">)</span>

            <span class="c1"># Add interaction to Universe (pass if no universe exists)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_to_universe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="p">,</span> <span class="n">tpl</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atom_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the `set` of all ``atom_type``s that this ``BondedInteraction``</span>
<span class="sd">        corresponds to, including `None` if appropriate.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Set[Union[int, NoneType]]</span>
<span class="sd">            A set of all (unique) ``atom_type``s.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span> <span class="k">for</span> <span class="n">atom_tuple</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atom_tuple</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">universe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;Universe&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the ``Universe`` to which the ``BondedInteraction`` belongs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Universe</span>
<span class="sd">            The ``Universe`` to which the ``BondedInteraction`` belongs or</span>
<span class="sd">            `None`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">universe</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="BondedInteraction.element_list">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.BondedInteraction.element_list">[docs]</a>
    <span class="k">def</span> <span class="nf">element_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a `list` of the elements for which the ``BondedInteraction`` applies</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            The elements for which the ``BondedInteraction`` applies</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Each tuple should contain the same elements, so first tuple&#39;s used</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n_atoms</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates that the correct number of atoms have been passed to the</span>
<span class="sd">        interaction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atoms : list</span>
<span class="sd">            A `list` of ``Atom`` to validate</span>
<span class="sd">        n_atoms : int</span>
<span class="sd">            The expected number of ``Atom`` objects in ``atoms``</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If the number of ``Atom`` objects in ``atoms`` is not equal to</span>
<span class="sd">            ``n_atoms``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">n_atoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This interaction only accepts </span><span class="si">{</span><span class="n">n_atoms</span><span class="si">}</span><span class="s2"> atoms&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="BondedInteraction.add_atoms">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.BondedInteraction.add_atoms">[docs]</a>
    <span class="k">def</span> <span class="nf">add_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atoms</span><span class="p">:</span> <span class="s1">&#39;Atom&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add atoms which are all involved in one example of this interaction</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *atoms</span>
<span class="sd">            one or more ``Atom`` objects</span>
<span class="sd">        **settings</span>
<span class="sd">            ``from_structure`` (`bool`)</span>
<span class="sd">                If ``add_atoms`` has been called from a ``Structure``</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If this ``BondedInteraction`` has already been applied to one or</span>
<span class="sd">            more of the ``atoms``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_duplicates</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This interaction has already been applied to this&#39;</span>
                             <span class="s1">&#39; atom(s)&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
        <span class="n">from_structure</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;from_structure&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_structure</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
                <span class="n">atom</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_interaction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_to_universe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">universe</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_check_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structs</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for duplicates ``Structure``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structs : list</span>
<span class="sd">            A `list` of ``Structure``</span>
<span class="sd">        err_msg : str</span>
<span class="sd">            A `str` to provide as an error message if there is a duplicate</span>
<span class="sd">            ``Structure``</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If there is a duplicate ``Structure``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Each tuple in the list of atom tuples must be unique, and&#39;</span>
                   <span class="s1">&#39; each atom in a tuple must be unique&#39;</span><span class="p">)</span>

        <span class="c1"># Check for duplicates (or reverse duplicates)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">equivalent_structs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_equivalent_structures</span><span class="p">(</span><span class="n">structs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">equivalent_structs</span> <span class="o">=</span> <span class="n">structs</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">equivalent_structs</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">equivalent_structs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_equivalent_structures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structs</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;list[tuple[Atom]]&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            `list` of `tuple` of ``Atom`` orderings which are equivalent</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">structs</span> <span class="o">+</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">atom_tuple</span><span class="p">))</span> <span class="k">for</span> <span class="n">atom_tuple</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_add_to_universe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">universe</span><span class="p">:</span> <span class="s1">&#39;Universe&#39;</span><span class="p">,</span> <span class="n">atoms</span><span class="p">:</span> <span class="s1">&#39;tuple[Atom]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds interaction and atom tuple to ``universe``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        universe : Universe</span>
<span class="sd">            The ``Universe`` to which to add the ``Interaction`` and `tpl`</span>
<span class="sd">        tpl : tuple</span>
<span class="sd">            A `tuple` of ``Atom``</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">universe</span><span class="o">.</span><span class="n">add_bonded_interaction_pairs</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">))</span></div>



<div class="viewcode-block" id="ConstrainableMixin">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.ConstrainableMixin">[docs]</a>
<span class="nd">@repr_decorator</span><span class="p">(</span><span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ConstrainableMixin</span><span class="p">:</span>
    <span class="c1"># pylint: disable=too-few-public-methods</span>
    <span class="c1"># as this is a mixin class</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mixin class enabling classes inheriting from ``BondedInteraction`` to be</span>
<span class="sd">    constrained</span>

<span class="sd">    These constraints are then applied by a constraint algorithm (e.g. SHAKE),</span>
<span class="sd">    which is specified in the ``Universe`` to which the ``BondedInteraction``</span>
<span class="sd">    belongs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_tuples : list</span>
<span class="sd">        A `list` of `tuple`. Each `tuple` contains ``Atom`` objects which are</span>
<span class="sd">        bonded together. For three or more ``Atom`` objects, the order of the</span>
<span class="sd">        ``Atom`` objects within each `tuple` is important.</span>
<span class="sd">    **settings</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    constrained : bool</span>
<span class="sd">        Specifying whether the object is constrained</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_tuples</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">constrained</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;constrained&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">atom_tuples</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span></div>



<div class="viewcode-block" id="Bond">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Bond">[docs]</a>
<span class="nd">@repr_decorator</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Bond</span><span class="p">(</span><span class="n">ConstrainableMixin</span><span class="p">,</span> <span class="n">BondedInteraction</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A bond between any two atoms. Requires exactly two atoms in each</span>
<span class="sd">    ``atom_tuple``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_tuples : list</span>
<span class="sd">        A `list` of `tuple`. Each `tuple` contains ``Atom`` which are bonded</span>
<span class="sd">        together.</span>
<span class="sd">    **settings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_tuples</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>

        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">atom_tuples</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>

<div class="viewcode-block" id="Bond.is_equivalent">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.Bond.is_equivalent">[docs]</a>
    <span class="k">def</span> <span class="nf">is_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for equivalence between two ``BondedInteraction``s, specifically</span>
<span class="sd">        if they apply to the same ``atom_types``, have the same ``function``</span>
<span class="sd">        describing the interaction, and have the same ``constrained`` setting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : BondedInteraction</span>
<span class="sd">            The object to compare against.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrained</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">constrained</span></div>
</div>



<div class="viewcode-block" id="BondAngle">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.BondAngle">[docs]</a>
<span class="nd">@repr_decorator</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;constrained&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">BondAngle</span><span class="p">(</span><span class="n">ConstrainableMixin</span><span class="p">,</span> <span class="n">BondedInteraction</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A bond angle between any two bonds</span>

<span class="sd">    Requires three ``Atom`` objects (rotation around central atom) in each</span>
<span class="sd">    ``atom_tuple``. The atoms are ordered ``i``, ``j``, ``k``, where ``j`` is</span>
<span class="sd">    the central atom.  So:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        BondAngle(i, j, k) == BondAngle(k, j, i)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_tuples : list</span>
<span class="sd">        A `list` of `tuple`. Each `tuple` contains ``Atom`` which are bonded</span>
<span class="sd">        together. For three or more ``Atom`` objects, the order of the ``Atom``</span>
<span class="sd">        objects within each `tuple` is important.</span>
<span class="sd">    **settings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_tuples</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>

        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">atom_tuples</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>

<div class="viewcode-block" id="BondAngle.is_equivalent">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.BondAngle.is_equivalent">[docs]</a>
    <span class="k">def</span> <span class="nf">is_equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">BondedInteraction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks for equivalence between two ``BondedInteraction``s, specifically</span>
<span class="sd">        if they apply to the same ``atom_types``, have the same ``function``</span>
<span class="sd">        describing the interaction, and have the same ``constrained`` setting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : BondedInteraction</span>
<span class="sd">            The object to compare against.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">is_equivalent</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">constrained</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">constrained</span></div>
</div>



<div class="viewcode-block" id="DihedralAngle">
<a class="viewcode-back" href="../../../reference/api/MDMC.MD.html#MDMC.MD.interactions.DihedralAngle">[docs]</a>
<span class="nd">@repr_decorator</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;improper&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DihedralAngle</span><span class="p">(</span><span class="n">BondedInteraction</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dihedral angle between any two sets of three atoms, ``ijk`` and ``jkl``.</span>

<span class="sd">    Dihedral angles can be both proper and improper, where the angle between the</span>
<span class="sd">    two planes of ``ijk`` and ``jkl`` is fixed for improper dihedrals.</span>

<span class="sd">    The atoms of a proper ``DihedralAngle`` are ordered ``i``, ``j``, ``k``,</span>
<span class="sd">    ``l``, where ``j`` and ``k`` are the two central atoms.  So:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        DihedralAngle(i, j, k, l) == DihedralAngle(l, k, j, i)</span>

<span class="sd">    The atoms of an improper ``DihedralAngle`` are ordered ``i``, ``j``, ``k``,</span>
<span class="sd">    ``l``, where ``i`` is the central atom to which ``j``, ``k``, and ``l`` are</span>
<span class="sd">    all connected. So:</span>

<span class="sd">    .. highlight:: python</span>
<span class="sd">    .. code-block:: python</span>

<span class="sd">        (DihedralAngle(i, j, k, l, improper=True)</span>
<span class="sd">        == DihedralAngle(i, j, l, k, improper=True)</span>
<span class="sd">        == DihedralAngle(i, l, k, j, improper=True)</span>
<span class="sd">        == DihedralAngle(i, l, j, k, improper=True))</span>
<span class="sd">        == DihedralAngle(i, k, j, l, improper=True))</span>
<span class="sd">        == DihedralAngle(i, k, l, j, improper=True))</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_tuples : list</span>
<span class="sd">        A `list` of `tuple`. Each `tuple` contains four `Atom` objects which are</span>
<span class="sd">        bonded together by the ``DihedralAngle``, in the order specified.</span>
<span class="sd">    **settings</span>
<span class="sd">        ``improper`` (`bool`)</span>
<span class="sd">            Whether the ``DihedralAngle`` is improper or not.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    improper : bool</span>
<span class="sd">        Whether the ``DihedralAngle`` is improper or not, which affects the</span>
<span class="sd">        ``InteractionFunction`` which can be set for this ``DihedralAngle``. By</span>
<span class="sd">        default this is set to `False` i.e. the interaction is a proper</span>
<span class="sd">        dihedral.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_tuples</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>

        <span class="n">settings</span><span class="p">[</span><span class="s1">&#39;n_atoms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">improper</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;improper&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">atom_tuples</span><span class="p">,</span> <span class="o">**</span><span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_equivalent_structures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structs</span><span class="p">:</span> <span class="s1">&#39;list[tuple[Atom]]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structs: list[tuple[Atom]]</span>
<span class="sd">            A list of tuples of Atoms.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            `list` of `tuple` of ``Atom`` orderings which are equivalent</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Improper dihedrals are equivalent if they have the same first</span>
        <span class="c1"># (central) atom, and any permutation of the other three atoms</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">improper</span><span class="p">:</span>
            <span class="n">equivalent</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">atom_tuple</span> <span class="ow">in</span> <span class="n">structs</span><span class="p">:</span>
                <span class="n">equivalent</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">atom_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">)</span> <span class="o">+</span> <span class="n">permutation</span> <span class="k">for</span> <span class="n">permutation</span>
                               <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">atom_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
            <span class="k">return</span> <span class="n">equivalent</span>
        <span class="c1"># Proper dihedrals are equivalent if they are reversed (as with Bond and</span>
        <span class="c1"># BondAngle)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_equivalent_structures</span><span class="p">(</span><span class="n">structs</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">_add_atom_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atom_types</span><span class="p">:</span> <span class="s1">&#39;list[int]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for dynamically creating an ``add_atom_types`` method in</span>
<span class="sd">    ``Coulombic``</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atom_types : list</span>
<span class="sd">        One or more `int` specifying ``atom_types`` that exist in ``universe``</span>
<span class="sd">        of the ``Coulombic``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">*</span><span class="n">atom_types</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_add_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">atoms</span><span class="p">:</span> <span class="s1">&#39;list[Atom]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for dynamically creating an ``add_atoms`` method in ``Coulombic``</span>

<span class="sd">    Adds ``*atoms`` to ``Coulombic`` and adds ``Coulombic`` to</span>
<span class="sd">    ``atoms.nonbonded_interactions``</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    atoms : list</span>
<span class="sd">        list of ``Atom``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
        <span class="c1"># Add atom to interaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        <span class="c1"># Add interaction to atom</span>
        <span class="n">atom</span><span class="o">.</span><span class="n">add_interaction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_interaction</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Add atom_type to interaction.atom_types</span>
        <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">and</span> <span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atom_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">atom_type</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>